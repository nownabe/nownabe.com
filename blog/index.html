<!DOCTYPE html><html><head><meta charset="utf-8" /><title>nownab.log</title><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="https://storage.googleapis.com/code.getmdl.io/1.0.4/material.light_blue-pink.min.css" rel="stylesheet" /><script src="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.min.js"></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" /><link href="../stylesheets/blog.css" rel="stylesheet" /><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml" /></head><body><div class="mdl-layout mdl-js-layout" id="container"><header><h1 id="title"><a href="/blog">nownab.log</a><small><i class="material-icons md-18">description</i><span id="subtitle">logger.level = Logger::DEBUG</span></small></h1></header><div id="main" role="main"><p>Page 1 of 3</p><div class="mdl-grid" id="articles"><article class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><h2><a href="/blog/2015/09/22/test.html">Example Article</a><small>Sep 22</small></h2><p>This is an example article.</p>
</article><article class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><h2><a href="/blog/2015/08/31/redundant-geminabox.html">Gem in a Boxの冗長化</a><small>Aug 31</small></h2><p>Gem in a Box冗長化の情報があんまりない気がしたのでQiitaに記事を書きました。
みんなどうやってるんだろう。（そもそも同期とか冗長化とかいらない場合も多そう）</p>

<p>[http://qiita.com/nownabe/items/bd3f9328b314b6c0adf6:embed:cite]</p>

<p>この記事はデータの同期だけなので、フェイルオーバーはVIPなりLBなりでやればいいと思います。</p>

<ul>
  <li>新しいGemがPushされたときすぐさま同期したい</li>
  <li>ミドルウェアレイヤーでめんどくさいことしたくない</li>
</ul>

<p>って時にいいんじゃないかと思います。</p>
</article><article class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><h2><a href="/blog/2015/08/10/idcf-dns.html">お名前.comからIDCF DNSに移行した話</a><small>Aug 10</small></h2><p>ネームサーバーをお名前.comからIDCF DNSに移行しました。</p>

<p>IDCF DNSは1ドメイン50円で100レコードまでなら使い放題です（クエリ数に関係ない）。
お名前.comはドメイン取得のおまけで無料なので、50円余分に払わないといけません。
とはいえまあ50円です笑</p>

<p>APIで操作できるので動的にレコードが変化するようなドメインのDNSとしてはよさそうです。
ということでなけなしの50円を払いお名前.comから移行することにしました。</p>

<h1 id="section">流れ</h1>
<p>移行の流れとしては、次のようになります。</p>

<ol>
  <li>IDCF DNSに登録する</li>
  <li>IDCF DNSにゾーンを作成する</li>
  <li>IDCF DNSにレコードを登録する</li>
  <li>IDCF DNSでドメインを認証する</li>
  <li>ネームサーバーを切り替える</li>
</ol>

<h1 id="idcf-dns">IDCF DNSに登録する</h1>
<p>こちらにアクセスします。
[https://console.idcfcloud.com/dns/]</p>

<p>多分登録画面とかログイン画面とか出てくるはず。。。</p>

<h1 id="idcf-dns-1">IDCF DNSにゾーン作成</h1>
<p>無事にログインできるとこんな画面が出るので、「ゾーン作成」をクリックします。
[f:id:nownabe:20150809205557p:plain]</p>

<p>作成画面が出てくるので、ドメインやメールアドレスを入力します。
ドメインがそのままゾーン名となります。hogehoge.comみたいな感じです。</p>

<p>[f:id:nownabe:20150809205809p:plain]</p>

<p>これでゾーンが作成されました。</p>

<h1 id="idcf-dns-2">IDCF DNSにレコード登録</h1>
<p>次はレコードを登録していきます。</p>

<p>ゾーンが作成されると、このようにゾーン一覧に新しいゾーンが表示されます。</p>

<p>[f:id:nownabe:20150809210127p:plain]</p>

<p>ゾーン名をクリックすると、SOAレコードやNSレコードが登録されていることがわかります。
右上の「レコード登録」から今登録してあるレコードを登録していきます。</p>

<p>[f:id:nownabe:20150809210257p:plain]</p>

<p>今のところ登録できるレコードはA、CNAME、AAAA、MX、TXT、SRVのみです。</p>

<p>[f:id:nownabe:20150809210513p:plain]</p>

<p>こんな感じで、お名前.comと差異がないようにします。</p>

<p>[f:id:nownabe:20150810234436p:plain]</p>

<p>[f:id:nownabe:20150809211023p:plain]</p>

<h1 id="idcd-dns">IDCD DNSでドメイン認証</h1>
<p>ドメインの所有者であるということを確認するため、ドメインの認証が必要になっています。</p>

<p>IDCF DNSのゾーンページの、「認証する」をクリックします。</p>

<p>[f:id:nownabe:20150809211457p:plain]</p>

<p>すると、このような認証方法が書かれたモーダルが表示されます。</p>

<p>[f:id:nownabe:20150809213245p:plain]</p>

<p>モザイクばかりでわかりにくいですが、、、今回は新規ドメインではないので1番の方法を使用します。
よくあるTXTレコードに認証文字列を登録する方法です。</p>

<p>お名前.comの方で、TXTレコードを登録します。</p>

<p>[f:id:nownabe:20150809211943p:plain]</p>

<p>digコマンドでTXTレコードが確認できたら、準備完了です。</p>

<p>```bash
$ dig @157.7.32.53 hogehoge.com. TXT</p>

<p>; «» DiG 9.8.3-P1 «» @157.7.32.53 hogehoge.com. TXT
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -»HEADER«- opcode: QUERY, status: NOERROR, id: 53710
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 6
;; WARNING: recursion requested but not available</p>

<p>;; QUESTION SECTION:
;hogehoge.com.      IN  TXT</p>

<p>;; ANSWER SECTION:
hogehoge.com.   3600  IN  TXT "idcf-dns-token=xxxxxxxxxxxxxxxxxxxxxxxx"</p>

<p>;; AUTHORITY SECTION:
hogehoge.com.   86400 IN  NS  02.dnsv.jp.
hogehoge.com.   86400 IN  NS  01.dnsv.jp.
hogehoge.com.   86400 IN  NS  03.dnsv.jp.
hogehoge.com.   86400 IN  NS  04.dnsv.jp.</p>

<p>;; ADDITIONAL SECTION:
01.dnsv.jp.   86400 IN  A 157.7.32.53
02.dnsv.jp.   86400 IN  A 157.7.33.53
03.dnsv.jp.   86400 IN  A 157.7.32.35
03.dnsv.jp.   86400 IN  AAAA  2400:8500:3000::53
04.dnsv.jp.   86400 IN  A 157.7.33.35
04.dnsv.jp.   86400 IN  AAAA  2400:8500:3fff::53</p>

<p>;; Query time: 6 msec
;; SERVER: 157.7.32.53#53(157.7.32.53)
;; WHEN: Sun Aug  9 21:26:58 2015
;; MSG SIZE  rcvd: 285
```</p>

<p>準備ができたら、認証しましょう。</p>

<p>[f:id:nownabe:20150809213232p:plain]</p>

<p>無事に終わると認証完了とでます。</p>

<p>[f:id:nownabe:20150809213342p:plain]</p>

<p>ちゃんとIDCF DNSのネームサーバーで名前解決できるようになってます。</p>

<p>```bash
$ dig @ns01.idcfcloud.com hogehoge.com</p>

<p>; «» DiG 9.8.3-P1 «» @ns01.idcfcloud.com hogehoge.com
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -»HEADER«- opcode: QUERY, status: NOERROR, id: 37498
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0
;; WARNING: recursion requested but not available</p>

<p>;; QUESTION SECTION:
;hogehoge.com.      IN  A</p>

<p>;; ANSWER SECTION:
hogehoge.com.   3600  IN  A 1.2.3.4</p>

<p>;; Query time: 9 msec
;; SERVER: 210.140.183.65#53(210.140.183.65)
;; WHEN: Sun Aug  9 21:34:00 2015
;; MSG SIZE  rcvd: 46
```</p>

<h1 id="section-1">ネームサーバー切り替え</h1>
<p>いよいよ、ネームサーバーを切り替えます。</p>

<p>お名前.comの、「ドメイン設定 &gt; ネームサーバーの変更」を開きます。
切り替えたいドメインを選択し、「他のネームサーバーを利用」を選びます。</p>

<p>[f:id:nownabe:20150809213938p:plain]</p>

<p>IDCF DNSのネームサーバーを入力し、設定します。</p>

<p>[f:id:nownabe:20150809214107p:plain]</p>

<p>これで切り替え完了です。
digコマンドで確認できます。
（切り替えに1日〜2日ぐらいかかります）</p>

<p>```bash
dig bar.hogehoge.com</p>

<p>; «» DiG 9.8.3-P1 «» bar.hogehoge.com
;; global options: +cmd
;; Got answer:
;; -»HEADER«- opcode: QUERY, status: NOERROR, id: 7938
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 3, ADDITIONAL: 3</p>

<p>;; QUESTION SECTION:
;bar.hogehoge.com.    IN  A</p>

<p>;; ANSWER SECTION:
bar.hogehoge.com. 3600  IN  CNAME foo.hogehoge.com.
foo.hogehoge.com. 3595  IN  A 5.6.7.8</p>

<p>;; AUTHORITY SECTION:
hogehoge.com.   3574  IN  NS  ns02.idcfcloud.com.
hogehoge.com.   3574  IN  NS  ns03.idcfcloud.com.
hogehoge.com.   3574  IN  NS  ns01.idcfcloud.com.</p>

<p>;; ADDITIONAL SECTION:
ns01.idcfcloud.com. 570 IN  A 210.140.183.65
ns02.idcfcloud.com. 570 IN  A 202.234.29.33
ns03.idcfcloud.com. 570 IN  A 210.152.232.97</p>

<p>;; Query time: 27 msec
;; SERVER: 192.168.63.100#53(192.168.63.100)
;; WHEN: Mon Aug 10 23:36:06 2015
;; MSG SIZE  rcvd: 186
```</p>

<h1 id="section-2">おわりに</h1>
<p>Web UIはシンプルで使いやすくてGoodですね！
料金がクエリ数に関係ないのも素晴らしい。</p>

<p>ドメイン取得も一括でできたらなぁ。</p>
</article><article class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><h2><a href="/blog/2015/08/09/raspberry-pi-lchika.html">今更Raspberry PiでLチカやってみた</a><small>Aug  9</small></h2><p>[f:id:nownabe:20150808235527j:plain]</p>

<p>流行りにのってRaspberry PiでLチカやってみました！（だいぶ乗り遅れてる）</p>

<p>Raspberry Piは<a href="http://svfes2015.ds.jp-east.idcfcloud.com/index.html">サバフェス</a>の賞品でもらったまま眠ってたのがあったので引っ張り出してきました。
LEDとかは家にあったものを拾い集めました。</p>

<h1 id="raspberry-pi">Raspberry Pi準備</h1>
<p>OSのインストールや初期設定はQiitaにまとめました。</p>

<p>[http://qiita.com/nownabe/items/e16b962fcdb1a702093e:embed:cite]</p>

<p>[http://qiita.com/nownabe/items/a6ec3dfcfcb6ab37ea1e:embed:cite]</p>

<p>これ以外でやったのはパッケージのアップデートと、</p>

<p><code>bash
sudo apt-get update -y
sudo apt-get upgrade -y
</code></p>

<p>NTP設定です。
NTPは<code>/etc/ntp.conf</code>の<code>server</code>の行をコメントアウトして<code>pool ntp.nict.jp iburst</code>を追加します。</p>

<p><code>
#server 0.debian.pool.ntp.org iburst
#server 1.debian.pool.ntp.org iburst
#server 2.debian.pool.ntp.org iburst
#server 3.debian.pool.ntp.org iburst
pool ntp.nict.jp iburst
</code></p>

<h1 id="l">Lピカ</h1>
<p>GPIOの4番ピンを使います。</p>

<p>まずはGPIOの4番ピンを使うことを宣言します
これで<code>/sys/class/gpio/gpio4</code>というリンクが作成されます。</p>

<p><code>bash
pi@raspberrypi ~ $ sudo echo 4 &gt; /sys/class/gpio/export
pi@raspberrypi ~ $ ls /sys/class/gpio
export  gpio4  gpiochip0  unexport
</code></p>

<p>GPIO4を出力用に設定します。</p>

<p><code>bash
pi@raspberrypi ~ $ sudo echo out &gt; /sys/class/gpio/gpio4/direction
pi@raspberrypi ~ $ sudo cat /sys/class/gpio/gpio4/direction
out
</code></p>

<p><code>/sys/class/gpio/gpio4/value</code>に1/0を出力することで、ON/OFFします。</p>

<p><code>bash
pi@raspberrypi ~ $ sudo echo 1 &gt; /sys/class/gpio/gpio4/value
pi@raspberrypi ~ $ sudo echo 0 &gt; /sys/class/gpio/gpio4/value
pi@raspberrypi ~ $ sudo echo 1 &gt; /sys/class/gpio/gpio4/value
pi@raspberrypi ~ $ sudo echo 0 &gt; /sys/class/gpio/gpio4/value
</code></p>

<p>LEDが光ったり消えたりします。</p>

<p>[f:id:nownabe:20150808235527j:plain]</p>

<h1 id="l-1">Lチカ</h1>
<p>点滅させてみます。とりあえずbashで。。。</p>

<p><code>bash
while :; do sudo echo 1 &gt; /sys/class/gpio/gpio4/value; sleep 0.001; sudo echo 0 &gt; /sys/class/gpio/gpio4/value; sleep 0.001; done
</code></p>

<p>[https://youtu.be/jThq1LOG9IQ:embed:cite]</p>

<h1 id="section">電圧？</h1>
<p>電圧を測ってみると5Vピンも3Vピンも3.3Vでした。
う〜んなんでだろう。</p>

<p>[f:id:nownabe:20150808235625j:plain]</p>

<p>GNDと畳の電位差はほとんどなかったのでGNDはちゃんととれてるみたいですw
[f:id:nownabe:20150808235731j:plain]</p>

<h1 id="section-1">おわりに</h1>
<p>高専時代にやったZ80ぶりのLチカでした。</p>

<p>最初トランジスタも発見したのでトランジスタでスイッチングしようと思ったんですがうまく行かず。。。
すっかりもう色々忘れてて歳を感じてやばいのでそのうちやりますw</p>
</article><article class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><h2><a href="/blog/2015/05/24/intro-headphone-amp.html">機材紹介：ヘッドホンアンプ</a><small>May 24</small></h2><p>今日は前回までとはちょっと毛色が違って、音を鳴らすためではなく聴くための機材です。</p>

<p>[f:id:nownabe:20150524220508j:plain]</p>

<p>5年か10年か前にヘッドホンアンプ欲しいけど安く済ませたい！ってことで自作したヘッドホンアンプです。NE5532という有名なオペアンプを使ってます。
もうえらい長いこと使ってますが、まだまだ現役で使えてます。</p>

<p>配線にLANケーブルを使ってたりケースがふにゃふにゃだったりボリュームにガリが入ってたり手作り感満載ですが、音はとても良いです。
すっと聴きやすくほんのりパワフルになる感じです。
元々重め激しめの曲はちょっと軽くおとなしくなってしまいます。</p>

<p>作るときの一番のミスはICソケット使わなかったことですね。。。
なぜか基盤に直接半田付けするというアホなことしてしまったので、オペアンプ取り替える遊びができません。
まあそんな色々聴いても違いはわからんのでいいんですがちょっと残念です。</p>

<p>というわけで全然Goodに使えてる自作のヘッドホンアンプなんですが、機能が限られてたり使いにくかったりするので普通のヘッドホンアンプも買おうかなーと検討中です。</p>
</article></div><p><a href="/blog/page/2/">Next page</a></p></div><aside><h2>Recent Articles</h2><ol><li><a href="/blog/2015/09/22/test.html">Example Article</a><span>Sep 22</span></li><li><a href="/blog/2015/08/31/redundant-geminabox.html">Gem in a Boxの冗長化</a><span>Aug 31</span></li><li><a href="/blog/2015/08/10/idcf-dns.html">お名前.comからIDCF DNSに移行した話</a><span>Aug 10</span></li><li><a href="/blog/2015/08/09/raspberry-pi-lchika.html">今更Raspberry PiでLチカやってみた</a><span>Aug  9</span></li><li><a href="/blog/2015/05/24/intro-headphone-amp.html">機材紹介：ヘッドホンアンプ</a><span>May 24</span></li><li><a href="/blog/2015/05/21/backup-to-idcf.html">超簡単にサーバのデータをIDCFオブストに定期バックアップするItamaeプラグイン</a><span>May 21</span></li><li><a href="/blog/2015/05/20/release-to-geminabox.html">Gem in a Boxに簡単にリリースできるGem作ったけどいっぱいあったのでまとめ</a><span>May 20</span></li><li><a href="/blog/2015/05/17/intro-wind-chime.html">機材紹介：ウィンドチャイム</a><span>May 17</span></li><li><a href="/blog/2015/04/19/github-pages.html">Github Pagesが便利すぎてイイ</a><span>Apr 19</span></li><li><a href="/blog/2015/03/14/serverfesta.html">サバフェス始まりました</a><span>Mar 14</span></li></ol><h2>Tags</h2><ol><li><a href="/blog/tags/band.html">band (2)</a></li><li><a href="/blog/tags/instruments.html">instruments (3)</a></li><li><a href="/blog/tags/drums.html">drums (2)</a></li><li><a href="/blog/tags/tech.html">tech (8)</a></li><li><a href="/blog/tags/ruby.html">ruby (4)</a></li><li><a href="/blog/tags/geminabox.html">geminabox (2)</a></li><li><a href="/blog/tags/itamae.html">itamae (1)</a></li><li><a href="/blog/tags/idcf.html">idcf (2)</a></li><li><a href="/blog/tags/diary.html">diary (4)</a></li><li><a href="/blog/tags/leveldb.html">leveldb (1)</a></li><li><a href="/blog/tags/ruboty.html">ruboty (1)</a></li><li><a href="/blog/tags/dns.html">dns (1)</a></li><li><a href="/blog/tags/raspberrypi.html">raspberrypi (1)</a></li><li><a href="/blog/tags/example.html">example (1)</a></li></ol><h2>By Year</h2><ol><li><a href="/blog/2015.html">2015 (15)</a></li></ol></aside></div></body></html>